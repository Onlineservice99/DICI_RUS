{"version":3,"file":"script.bundle.js","sources":["../src/script.js"],"sourcesContent":["'use strict';\r\n\r\nexport class SaleOrderAjax {\r\n\r\n    constructor(sign, options)\r\n    {\r\n        this.sessid = BX.bitrix_sessid();\r\n        this.sign = sign;\r\n        this.options = options;\r\n        this.initEventListener()\r\n    }\r\n\r\n    initEventListener()\r\n    {\r\n        const instance = this\r\n        $(document).on('change', '.js-refresh-elem', function(){\r\n            let data = $('#soa-form').serializeArray()\r\n            let obj = {};\r\n            for (let key in data) {\r\n                obj[data[key].name] = data[key].value;\r\n\r\n            }\r\n            instance.sendRequest(obj)\r\n        })\r\n        $(document).on('click', '#soa-submit-button', function(e){\r\n            e.preventDefault()\r\n            let form = $('#soa-form');\r\n            let data = form.serializeArray()\r\n            let obj = {};\r\n            for (let key in data) {\r\n                obj[data[key].name] = data[key].value;\r\n            }\r\n            let nameFile = form.find('input[type=\"file\"]');\r\n            if (nameFile[0].files[0] !== undefined) {\r\n                obj[nameFile.attr('name')] = nameFile[0].files[0];\r\n            }\r\n            instance.saveOrderAjax(obj)\r\n        })\r\n        this.sendRequest()\r\n    }\r\n\r\n    saveOrderAjax(data)\r\n    {\r\n        const instance = this\r\n        let obj = {\r\n            sessid: this.sessid,\r\n            signedParamsString: this.sign,\r\n            via_ajax: \"Y\",\r\n            SITE_ID: this.options.siteId,\r\n            'soa-action': 'saveOrderAjax',\r\n        }\r\n\r\n        obj = Object.assign(data, obj);\r\n\r\n        let test = new FormData();\r\n\r\n        for (let key in obj ) {\r\n            test.append(key, obj[key]);\r\n        }\r\n\r\n        $.ajax({\r\n            url: '/bitrix/components/bitrix/sale.order.ajax/ajax.php',\r\n            data: test,\r\n            method: \"POST\",\r\n            processData: false,\r\n            contentType: false,\r\n            success: function(e)\r\n            {\r\n                if (e.order.ID > 0) {\r\n                    window.location = e.order.REDIRECT_URL;\r\n                }\r\n                //instance.parseResponse(e)\r\n            }\r\n        })\r\n    }\r\n\r\n    sendRequest(data = {}, action = 'refreshOrderAjax')\r\n    {\r\n        const instance = this\r\n        let obj = {\r\n            sessid: this.sessid,\r\n            signedParamsString: this.sign,\r\n            via_ajax: \"Y\",\r\n            SITE_ID: this.options.siteId,\r\n            'soa-action': action,\r\n        }\r\n\r\n        let result = {}\r\n\r\n        if (action === 'saveOrderAjax') {\r\n            result = Object.assign(data, obj);\r\n        } else {\r\n            obj.order = data;\r\n            result = obj;\r\n        }\r\n\r\n\r\n\r\n        $.ajax({\r\n            url: '/bitrix/components/bitrix/sale.order.ajax/ajax.php',\r\n            data: result,\r\n            method: \"POST\",\r\n            success: function(e)\r\n            {\r\n                instance.parseResponse(e)\r\n            }\r\n        })\r\n    }\r\n\r\n    parseResponse(json)\r\n    {\r\n        this.createDeliveries(json.order.DELIVERY);\r\n        this.createPayments(json.order.PAY_SYSTEM)\r\n        this.createItems(json.order.GRID.ROWS)\r\n        this.updatePropFields(json.order)\r\n        this.updateRightBlock(json.order)\r\n    }\r\n\r\n    createDeliveries(deliveries)\r\n    {\r\n        let block = $('[data-delivery]');\r\n        let html = '';\r\n        for (let key in deliveries) {\r\n            let ch = '';\r\n            if (deliveries[key].CHECKED === 'Y') {\r\n                ch = 'checked=\"checked\"';\r\n            }\r\n            html +='<div class=\"form-block\">' +\r\n                '<label class=\"form-block__checkbox form-block__checkbox--radio\"  onclick=\"$(\\'#delivery-link'+deliveries[key].ID+'\\').tab(\\'show\\')\">' +\r\n                '<input class=\"js-refresh-elem\" type=\"radio\" name=\"DELIVERY_ID\" value=\"'+deliveries[key].ID+'\" '+ch+'><span' +\r\n                ' class=\"p-md\">'+deliveries[key].NAME+'</span>' +\r\n                '</label>' +\r\n                '</div>'\r\n        }\r\n\r\n        block.html(html)\r\n    }\r\n\r\n    createPayments(payments)\r\n    {\r\n        let block = $('[data-payments]');\r\n        let html = '';\r\n        for (let key in payments) {\r\n            let ch = '';\r\n            if (payments[key].CHECKED === 'Y') {\r\n                ch = 'checked=\"checked\"';\r\n            }\r\n            html += '<div class=\"form-block mb-16\">' +\r\n                '<label class=\"form-block__checkbox form-block__checkbox--radio\">' +\r\n                '<input class=\"js-refresh-elem\" type=\"radio\" name=\"PAY_SYSTEM_ID\" value=\"'+payments[key].ID+'\" '+ch+'><span' +\r\n                ' class=\"p-md\">'+payments[key].NAME+'</span>' +\r\n                '</label>' +\r\n                '</div>'\r\n        }\r\n\r\n        block.html(html)\r\n    }\r\n\r\n    createItems(items)\r\n    {\r\n        let block = $('[data-items]');\r\n        let html = '';\r\n        let num = 1;\r\n        for (let key in items) {\r\n            let price = items[key].data.PRICE_FORMATED;\r\n            if (items[key].data.BASE_PRICE != items[key].data.SUM_NUM) {\r\n                price = '<s>'+items[key].data.BASE_PRICE_FORMATED+'</s>'+items[key].data.PRICE_FORMATED;\r\n            }\r\n            html += '<div class=\"basket-item\">' +\r\n                '<div class=\"basket-item__num\"><span>'+num+'</span>00429</div>' +\r\n                '<a class=\"basket-item__img-wrap\" href=\"'+items[key].data.DETAIL_PAGE_URL+'\">' +\r\n                '<img src=\"'+items[key].data.PREVIEW_PICTURE_SRC+'\" alt=\"\">' +\r\n                '</a>' +\r\n                '<div class=\"basket-item__name-wrap\">' +\r\n                '<div class=\"basket-item__brand p-xs text-gray mb-16\">ENSTO</div>' +\r\n                '<a class=\"basket-item__title link\" href=\"'+items[key].data.DETAIL_PAGE_URL+'\">'+items[key].data.NAME+'</a>' +\r\n                '</div>' +\r\n                '<div class=\"basket-item__price-wrap\">' +\r\n                '<div class=\"d-flex align-items-center justify-content-between\">' +\r\n                '<div class=\"basket-item__price text-xl-right\">' +\r\n                price +\r\n                '</div>' +\r\n                '<div class=\"basket-item__count\">x '+items[key].data.QUANTITY+'</div>' +\r\n                '<div class=\"basket-item__price basket-item__price--total\"><span' +\r\n                ' class=\"fw-600\">'+items[key].data.SUM+'</span></div>' +\r\n                '</div>' +\r\n                '</div>' +\r\n                '</div>'\r\n        }\r\n        num++;\r\n\r\n        block.html(html)\r\n    }\r\n\r\n    updatePropFields(info)\r\n    {\r\n        console.log(info)\r\n    }\r\n\r\n    updateRightBlock(info)\r\n    {\r\n        let quantity = 0\r\n        for (let key in info.GRID.ROWS) {\r\n            quantity += info.GRID.ROWS[key].data.QUANTITY;\r\n        }\r\n        $('[data-all-quantity]').html(quantity)\r\n        $('[data-all-price]').html(info.TOTAL.ORDER_TOTAL_PRICE_FORMATED)\r\n        $('[data-all-discount]').html(\"- \"+info.TOTAL.DISCOUNT_PRICE_FORMATED)\r\n        $('[data-all-delivery]').html(\"+ \"+info.TOTAL.DELIVERY_PRICE_FORMATED)\r\n    }\r\n}"],"names":["SaleOrderAjax","sign","options","sessid","BX","bitrix_sessid","initEventListener","instance","$","document","on","data","serializeArray","obj","key","name","value","sendRequest","e","preventDefault","form","nameFile","find","files","undefined","attr","saveOrderAjax","signedParamsString","via_ajax","SITE_ID","siteId","Object","assign","test","FormData","append","ajax","url","method","processData","contentType","success","order","ID","window","location","REDIRECT_URL","action","result","parseResponse","json","createDeliveries","DELIVERY","createPayments","PAY_SYSTEM","createItems","GRID","ROWS","updatePropFields","updateRightBlock","deliveries","block","html","ch","CHECKED","NAME","payments","items","num","price","PRICE_FORMATED","BASE_PRICE","SUM_NUM","BASE_PRICE_FORMATED","DETAIL_PAGE_URL","PREVIEW_PICTURE_SRC","QUANTITY","SUM","info","console","log","quantity","TOTAL","ORDER_TOTAL_PRICE_FORMATED","DISCOUNT_PRICE_FORMATED","DELIVERY_PRICE_FORMATED"],"mappings":"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"}