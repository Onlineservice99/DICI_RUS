{"version":3,"file":"script.bundle.js","sources":["../src/script.js"],"sourcesContent":["'use strict';\r\n\r\nexport class SaleSearchCity {\r\n\r\n    constructor()\r\n    {\r\n        this.sessid = BX.bitrix_sessid();\r\n        this.locationBlock = $('#location')\r\n        this.cityUl = $('#js-city-ul')\r\n        this.initEventListener()\r\n    }\r\n\r\n    initEventListener()\r\n    {\r\n        const instance = this\r\n        instance.ajax = false;\r\n        $(document).on('keyup', '#location', function(){\r\n            if ($(this).val().length > 2 && !instance.ajax) {\r\n                instance.ajax = true\r\n                instance.sendRequest()\r\n            }\r\n        })\r\n\r\n        $(document).on('click', \"#js-city-ul li\", function(){\r\n            let city = instance.cityLast.ITEMS[$(this).data('code')]\r\n            let name = city.DISPLAY\r\n            city.PATH.forEach(function(item) {\r\n                name += \", \"+instance.cityLast.ETC.PATH_ITEMS[item].DISPLAY\r\n            })\r\n            instance.locationBlock.parent().find('input[type=\"hidden\"]').val(city.CODE);\r\n            instance.locationBlock.val(name)\r\n            instance.cityUl.addClass('d-none')\r\n            instance.locationBlock.parent().find('input[type=\"hidden\"]').trigger('change');\r\n        })\r\n    }\r\n\r\n    sendRequest()\r\n    {\r\n        const instance = this\r\n\r\n        const select = {\r\n            'VALUE': 'ID',\r\n            'DISPLAY': 'NAME.NAME',\r\n            '1': 'TYPE_ID',\r\n            '2': 'CODE'\r\n        };\r\n        const additionals = {\r\n            '1': 'PATH'\r\n        }\r\n        let filter = {\r\n            '=PHRASE': $('#location').val(),\r\n            '=NAME.LANGUAGE_ID': 'ru',\r\n            '=SITE_ID': 's1'\r\n        }\r\n        let result = {\r\n            'select': select,\r\n            'additionals': additionals,\r\n            'filter': filter,\r\n            'version': 2,\r\n            'PAGE_SIZE': 10,\r\n            'PAGE': 0\r\n        }\r\n\r\n        $.ajax({\r\n            url: '/bitrix/components/bitrix/sale.location.selector.search/get.php',\r\n            data: result,\r\n            method: \"POST\",\r\n            success: function(e, b)\r\n            {\r\n                instance.ajax = false\r\n                try {\r\n                    //hotfix\r\n                    let string = e.replace(/\\'/g, \"\\\"\");\r\n                    let json = JSON.parse(string)\r\n                    instance.createElems(json)\r\n                } catch (ex) {\r\n                    console.error(ex)\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    createElems(json)\r\n    {\r\n        let text = '';\r\n        this.cityLast = json.data;\r\n        for (var key in json.data.ITEMS) {\r\n            text += \"<li data-code='\"+key+\"'>\"+json.data.ITEMS[key].DISPLAY+\"</li>\"\r\n        }\r\n        this.cityUl.removeClass('d-none').find('ul').html(text);\r\n    }\r\n}\r\n"],"names":["SaleSearchCity","sessid","BX","bitrix_sessid","locationBlock","$","cityUl","initEventListener","instance","ajax","document","on","val","length","sendRequest","city","cityLast","ITEMS","data","name","DISPLAY","PATH","forEach","item","ETC","PATH_ITEMS","parent","find","CODE","addClass","trigger","select","additionals","filter","result","url","method","success","e","b","string","replace","json","JSON","parse","createElems","ex","console","error","text","key","removeClass","html"],"mappings":"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"}