{"version":3,"file":"script.bundle.js","sources":["../src/script.js"],"sourcesContent":["'use strict';\r\n\r\nexport class CartPage {\r\n\r\n    constructor(sign, options)\r\n    {\r\n        this.sessid = BX.bitrix_sessid();\r\n        this.sign = sign;\r\n        this.options = options;\r\n        this.initEventListener()\r\n    }\r\n\r\n    initEventListener()\r\n    {\r\n        const instance = this\r\n\r\n        $('.js-spin-count').on('change', function() {\r\n            let elem = $(this)\r\n            let parent = elem.parents('.basket-item');\r\n            let id = parent.data('element-basket');\r\n            let price = instance.update(id, elem.val(), parent)\r\n\r\n        })\r\n\r\n        $('#coupon_input').on('blur', function(e){\r\n            let field = $(this)\r\n            let basket = {\r\n                coupon: field.val()\r\n            }\r\n            let data = {\r\n                basket\r\n            }\r\n            instance.sendRequest(data);\r\n        })\r\n\r\n        $('#clear_basket').on('click', function(e){\r\n            e.preventDefault()\r\n            $.ajax({\r\n                url: '/local/ajax/api/basket/clear.php',\r\n                success: function() {\r\n                    location.reload();\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    update(id, value, elem)\r\n    {\r\n        const instance = this\r\n\r\n        $.ajax({\r\n            url: '/local/ajax/api/basket/update.php',\r\n            data: {id: id, quantity: value},\r\n            method: \"POST\",\r\n            success: function(e) {\r\n                //elem.find('.basket-item__price--total span').html(e.price);\r\n                instance.sendRequest({});\r\n            }\r\n        })\r\n    }\r\n\r\n    sendRequest(data, action = 'recalculateAjax')\r\n    {\r\n        const instance = this\r\n        let obj = {\r\n            sessid: this.sessid,\r\n            signedParamsString: this.sign,\r\n            via_ajax: \"Y\",\r\n            site_id: this.options.siteId,\r\n            site_template_id: this.options.siteTemplateId,\r\n            template: this.options.templateFolder,\r\n            basketAction: action\r\n        }\r\n\r\n        let dataSend = Object.assign(obj, data);\r\n        $.ajax({\r\n            url: '/bitrix/components/bitrix/sale.basket.basket/ajax.php',\r\n            data: dataSend,\r\n            method: \"POST\",\r\n            success: function(e)\r\n            {\r\n                instance.parseResponse(e)\r\n            }\r\n        })\r\n    }\r\n\r\n    generatePDF() {\r\n        const element = document.getElementById('basket-download');\r\n        html2pdf()\r\n            .from(element)\r\n            .save();\r\n    }\r\n\r\n    sendBasket() {\r\n        let basket = '<table><tbody>'\r\n        $('.basket-item').each(function(){\r\n            basket += \"<tr>\"\r\n            basket += \"<td>\"+$(this).find('.basket-item__num').html()+\"</td>\"\r\n            basket += \"<td>\"+$(this).find('.basket-item__title').html()+\"</td>\"\r\n            basket += \"</tr>\"\r\n        })\r\n        basket += '</tbody></table>'\r\n\r\n        $('.js-send-basket').find('[name=\"basket-items\"]').val(basket);\r\n\r\n        $.ajax({\r\n            url: '/bitrix/components/bitrix/sale.basket.basket/ajax.php',\r\n            data: dataSend,\r\n            method: \"POST\",\r\n            success: function(e)\r\n            {\r\n                instance.parseResponse(e)\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    parseResponse(json)\r\n    {\r\n        $(\".basket__total-price\").html(json.BASKET_DATA.allSum_FORMATED);\r\n        $(\"[data-cart-count]\").html(json.CHANGED_BASKET_ITEMS.length);\r\n        if (json.BASKET_DATA.DISCOUNT_PRICE_ALL > 0) {\r\n            $(\"#discount-price\").html(json.BASKET_DATA.DISCOUNT_PRICE_FORMATED);  \r\n            $(\"#discount-price\").parent().parent().removeClass('d-none');\r\n        } else {\r\n            $(\"#discount-price\").parent().parent().addClass('d-none');\r\n        }\r\n        let couponLength = json.BASKET_DATA.COUPON_LIST.length\r\n\r\n        if (couponLength > 0) {\r\n            if (json.BASKET_DATA.COUPON_LIST[couponLength-1].JS_STATUS == 'BAD') {\r\n                $('#coupon_input').css('color', 'red');\r\n            } else {\r\n                $('#coupon_input').css('color', 'green');\r\n                $('#coupon_input').attr('disabled', 'disabled');\r\n            }\r\n        }\r\n\r\n\r\n        let items = json.BASKET_DATA.GRID.ROWS\r\n        for (let key in items) {\r\n            let elem = $('.basket-item[data-element-basket=\"'+items[key].PRODUCT_ID+'\"]');\r\n            elem.find('.basket-item__price--total span').html(items[key].SUM)\r\n            elem.find('.js-spin-count').val(items[key].QUANTITY)\r\n        }\r\n\r\n    }\r\n}\r\n"],"names":["CartPage","sign","options","sessid","BX","bitrix_sessid","initEventListener","instance","$","on","elem","parent","parents","id","data","price","update","val","e","field","basket","coupon","sendRequest","preventDefault","ajax","url","success","location","reload","value","quantity","method","action","obj","signedParamsString","via_ajax","site_id","siteId","site_template_id","siteTemplateId","template","templateFolder","basketAction","dataSend","Object","assign","parseResponse","element","document","getElementById","html2pdf","from","save","each","find","html","json","BASKET_DATA","allSum_FORMATED","CHANGED_BASKET_ITEMS","length","DISCOUNT_PRICE_ALL","DISCOUNT_PRICE_FORMATED","removeClass","addClass","couponLength","COUPON_LIST","JS_STATUS","css","attr","items","GRID","ROWS","key","PRODUCT_ID","SUM","QUANTITY"],"mappings":"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"}